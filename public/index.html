<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåê Proxy Hub</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Main Content -->
    <header>
        <h1>üåê Proxy Hub</h1>
        <button id="toggleTheme">Toggle Theme</button>
    </header>

    <section id="proxies">
        <h2>Available Proxies</h2>
        <ul id="proxyList">
            <!-- Proxy list will be dynamically loaded here -->
        </ul>
    </section>

    <!-- Suggest a Proxy Section -->
    <section id="suggestProxy" class="suggestion-form">
        <h2>Suggest a Proxy</h2>
        <form id="proxyForm">
            <label for="proxyName">Proxy Name:</label>
            <input type="text" id="proxyName" name="proxyName" required>

            <label for="proxyURL">Proxy URL:</label>
            <input type="url" id="proxyURL" name="proxyURL" required>

            <label for="proxyLogo">Logo (Optional):</label>
            <input type="file" id="proxyLogo" name="proxyLogo">

            <button type="submit">Submit Suggestion</button>
        </form>
    </section>

    <!-- Hidden section for Suggested Proxies (only for admins) -->
    <section id="suggestedProxies" class="admin-only">
        <h2>Suggested Proxies</h2>
        <ul id="suggestedProxyList">
            <!-- Suggested proxies will be dynamically loaded here -->
        </ul>
    </section>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Function to load proxies from API and display them
        function loadProxies() {
            $.get('/api/proxies', function(proxies) {
                const proxyList = $('#proxyList');
                proxyList.empty(); // Clear previous proxies
                proxies.forEach(proxy => {
                    proxyList.append(`<li><a href="${proxy.url}" target="_blank">${proxy.name}</a></li>`);
                });
            });
        }

        // Handle theme toggle
        $('#toggleTheme').click(function() {
            document.body.classList.toggle('dark-theme');
        });

        // Handle Proxy Suggestion Form Submission
        $('#proxyForm').submit(function(event) {
            event.preventDefault();
            
            const proxyName = $('#proxyName').val();
            const proxyURL = $('#proxyURL').val();
            const proxyLogo = $('#proxyLogo')[0].files[0]; // Get file

            const formData = new FormData();
            formData.append('name', proxyName);
            formData.append('url', proxyURL);
            if (proxyLogo) {
                formData.append('logo', proxyLogo);
            }

            $.ajax({
                url: '/api/submit-suggestion',  // Adjust endpoint as per your backend
                type: 'POST',
                data: formData,
                contentType: false,
                processData: false,
                success: function(response) {
                    alert('Suggestion submitted successfully!');
                    $('#proxyForm')[0].reset(); // Clear form
                },
                error: function() {
                    alert('Failed to submit suggestion. Please try again.');
                }
            });
        });

        // Optionally, only show the suggested proxies to admins
        function loadSuggestedProxies() {
            $.get('/api/suggested-proxies', function(suggestedProxies) {
                const suggestedProxyList = $('#suggestedProxyList');
                suggestedProxyList.empty(); // Clear previous suggestions
                suggestedProxies.forEach(suggestion => {
                    suggestedProxyList.append(`<li>${suggestion.name} - <button class="approve-btn" data-name="${suggestion.name}">Approve</button> <button class="reject-btn" data-name="${suggestion.name}">Reject</button></li>`);
                });

                // Admin approve/reject functionality
                $('.approve-btn').click(function() {
                    const name = $(this).data('name');
                    $.post('/api/approve-suggestion', { name }, function() {
                        alert('Proxy approved!');
                        loadSuggestedProxies(); // Reload the suggested proxies list
                    });
                });

                $('.reject-btn').click(function() {
                    const name = $(this).data('name');
                    $.ajax({
                        url: '/api/reject-suggestion',
                        type: 'DELETE',
                        data: { name },
                        success: function() {
                            alert('Proxy suggestion rejected.');
                            loadSuggestedProxies(); // Reload the suggested proxies list
                        }
                    });
                });
            });
        }

        // Load proxies and suggested proxies
        loadProxies();
        loadSuggestedProxies(); // This will be hidden unless the user is an admin
    </script>
</body>
</html>
